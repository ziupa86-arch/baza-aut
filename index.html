<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Car Database â€“ Offline</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111111">

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#111;
  color:#fff;
}
h1{
  text-align:center;
  margin:10px 0;
}
.container{
  padding:10px;
}
input,button{
  width:100%;
  padding:10px;
  margin:5px 0;
  font-size:16px;
}
button{
  background:#2ecc71;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
button.secondary{
  background:#3498db;
}
button.danger{
  background:#e74c3c;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  border:1px solid #444;
  padding:6px;
  text-align:left;
}
th{
  background:#222;
}
tr:hover{
  background:#333;
}

/* PRINT / PDF */
@media print{
  input,button{
    display:none;
  }
  body{
    background:#fff;
    color:#000;
  }
  th,td{
    border:1px solid #000;
  }
}
</style>
</head>

<body>

<h1>ðŸš— Car Database</h1>

<div class="container">

  <input id="make" placeholder="Make (e.g. BMW)">
  <input id="year" placeholder="Year (e.g. 2018)">
  <input id="camera" placeholder="Camera reading">
  <input id="color" placeholder="Color code (e.g. A52)">

  <button onclick="add()">Save</button>

  <input id="search" placeholder="Search..." oninput="render()">

  <button class="secondary" onclick="printPDF()">Print / PDF</button>
  <button class="secondary" onclick="exportData()">Export data</button>

  <table>
    <thead>
      <tr>
        <th>Make</th>
        <th>Year</th>
        <th>Camera reading</th>
        <th>Color code</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>

</div>

<script>
/* ===== STORAGE ===== */
const KEY = "car_database_offline";

const load = () => JSON.parse(localStorage.getItem(KEY) || "[]");
const save = d => localStorage.setItem(KEY, JSON.stringify(d));

const norm = v => (v || "").trim().toUpperCase();

/* ===== ADD ===== */
function add(){
  const make = norm(makeI.value);
  const year = yearI.value.trim();
  const camera = norm(cameraI.value);
  const color = norm(colorI.value);

  if(!make || !year || !camera || !color){
    alert("Fill all fields");
    return;
  }

  const data = load();
  data.unshift({make,year,camera,color});
  save(data);

  makeI.value = yearI.value = cameraI.value = colorI.value = "";
  render();
}

/* ===== DELETE ===== */
function del(i){
  if(!confirm("Delete entry?")) return;
  const d = load();
  d.splice(i,1);
  save(d);
  render();
}

/* ===== EDIT ===== */
function edit(i){
  const d = load();
  const x = d[i];
  if(!x) return;

  const make = norm(prompt("Make",x.make));
  const year = prompt("Year",x.year);
  const camera = norm(prompt("Camera reading",x.camera));
  const color = norm(prompt("Color code",x.color));

  if(!make || !year || !camera || !color) return;

  d[i] = {make,year,camera,color};
  save(d);
  render();
}

/* ===== RENDER ===== */
function render(){
  const q = norm(searchI.value);
  list.innerHTML = "";

  load().forEach((x,i)=>{
    const txt = `${x.make} ${x.year} ${x.camera} ${x.color}`;
    if(q && !txt.includes(q)) return;

    list.innerHTML += `
      <tr>
        <td>${x.make}</td>
        <td>${x.year}</td>
        <td>${x.camera}</td>
        <td>${x.color}</td>
        <td>
          <button onclick="edit(${i})">Edit</button>
          <button class="danger" onclick="del(${i})">Delete</button>
        </td>
      </tr>`;
  });
}

/* ===== PDF ===== */
function printPDF(){
  window.print();
}

/* ===== EXPORT ===== */
function exportData(){
  const data = localStorage.getItem(KEY);
  if(!data) return alert("No data");

  const blob = new Blob([data], {type:"application/json"});
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "car_database_backup.json";
  a.click();

  URL.revokeObjectURL(url);
}

/* ===== INIT ===== */
const makeI = document.getElementById("make");
const yearI = document.getElementById("year");
const cameraI = document.getElementById("camera");
const colorI = document.getElementById("color");
const searchI = document.getElementById("search");
const list = document.getElementById("list");

render();

/* ===== OFFLINE ===== */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>